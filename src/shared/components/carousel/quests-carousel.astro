---
const quests = [
	{
		title: "Отзыв с фото",
		description: "Развернутый отзыв + фотография",
		reward: "50–200₸",
		icon: "chat",
	},
	{
		title: "Приведи друга",
		description: "Рекомендует знакомому → он делает покупку",
		reward: "200–500₸",
		icon: "users",
	},
	{
		title: "Попробуй новинку",
		description: "Пробует новый продукт или услугу",
		reward: "100–300₸",
		icon: "star",
	},
	{
		title: "Оставь отзыв в приложении",
		description: "Оцени покупку и напиши короткий комментарий в приложении.",
		reward: "30–150₸",
		icon: "chat",
	},
	{
		title: "Поделись в соцсетях",
		description: "Поделись своим опытом и отметь бренд в соцсетях.",
		reward: "80–250₸",
		icon: "star",
	},
	{
		title: "Подпишись на рассылку",
		description: "Оформляет подписку на новости и спецпредложения.",
		reward: "20–100₸",
		icon: "users",
	},
	{
		title: "Заполни анкету",
		description: "Отвечает на несколько вопросов о предпочтениях.",
		reward: "50–180₸",
		icon: "chat",
	},
	{
		title: "Участвуй в опросе",
		description: "Проходит короткий опрос после посещения точки.",
		reward: "40–160₸",
		icon: "star",
	},
	{
		title: "Сделай повторную покупку",
		description: "Возвращается и покупает товар ещё раз.",
		reward: "150–400₸",
		icon: "users",
	},
	{
		title: "Приведи коллегу",
		description: "Рекомендует продукт коллеге по работе.",
		reward: "200–500₸",
		icon: "users",
	},
	{
		title: "Оставь видеоотзыв",
		description: "Записывает короткое видео о своём опыте.",
		reward: "150–350₸",
		icon: "star",
	},
	{
		title: "Протестируй новую функцию",
		description: "Пробует экспериментальную функцию и делится фидбеком.",
		reward: "120–300₸",
		icon: "chat",
	},
];
---

<section class="relative py-24 overflow-hidden">
  <div class="relative z-10 max-w-7xl mx-auto px-6" data-embla>
    <div>
      <div class="flex justify-between items-end mb-12">
        <div class="flex flex-col gap-4">
          <h2 class="text-left!">
            Создавайте
            <span class="gradient-text">любые квесты</span>
          </h2>
          <p>
            Превратите каждое взаимодействие в возможность заработать баллы.
          </p>
        </div>

        <div class="relative">
          <div class="flex items-center justify-end gap-3 mb-6">
            <button
              type="button"
              class="hidden md:flex items-center justify-center w-10 h-10 rounded-full border border-white/10 bg-white/5 text-white/70 hover:bg-white/10 hover:text-white transition-colors"
              aria-label="Предыдущий слайд"
              data-embla-prev
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <button
              type="button"
              class="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-[#0064FF] text-white shadow-[0_0_26px_rgba(0,100,255,0.7)] hover:bg-[#1a7bff] transition-colors"
              aria-label="Следующий слайд"
              data-embla-next
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="overflow-hidden" data-embla-viewport>
        <div class="flex gap-4 lg:gap-5 pb-4 carousel-track">
          {
            quests.map((quest) => (
              <article class="carousel-slide shrink-0 basis-[80%] sm:basis-[48%] lg:basis-[31%] max-w-full rounded-[28px] bg-white/3 border border-white/10 backdrop-blur-xl px-8 pt-8 pb-7 flex flex-col justify-between shadow-[0_18px_60px_rgba(0,0,0,0.55)]">
                <div class="flex flex-col gap-6">
                  <div class="w-14 h-14 rounded-2xl bg-linear-to-br from-[#0064FF] to-[#003C9F] flex items-center justify-center shadow-[0_0_32px_rgba(0,100,255,0.6)]">
                    {quest.icon === "chat" && (
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        class="w-7 h-7 text-white"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                      </svg>
                    )}
                    {quest.icon === "users" && (
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        class="w-7 h-7 text-white"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                      </svg>
                    )}
                    {quest.icon === "star" && (
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        class="w-7 h-7 text-white"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polygon points="12 2 15 8.5 22 9.3 17 14 18.5 21 12 17.7 5.5 21 7 14 2 9.3 9 8.5 12 2" />
                      </svg>
                    )}
                  </div>

                  <div class="space-y-3">
                    <h3 class="text-xl sm:text-2xl text-white font-medium">
                      {quest.title}
                    </h3>
                    <p class="text-white/70 leading-relaxed">
                      {quest.description}
                    </p>
                  </div>
                </div>

                <div class="mt-6 flex items-baseline gap-2">
                  <span class="text-white/60">Награда:</span>
                  <span class="text-[#0064FF] text-lg font-medium">
                    {quest.reward}
                  </span>
                </div>
              </article>
            ))
          }
        </div>
      </div>

      <div class="mt-8 flex items-center justify-center gap-2">
        {
          quests.map((_, index) => (
            <button
              type="button"
              class="carousel-dot"
              data-embla-dot={index}
              aria-label={`Показать слайд ${index + 1}`}
            />
          ))
        }
      </div>
    </div>
  </div>
</section>

<script>
  import EmblaCarousel from "embla-carousel";
  import Autoplay from "embla-carousel-autoplay";

  if (typeof window !== "undefined") {
    window.addEventListener("load", () => {
      document.querySelectorAll("[data-embla]").forEach((carousel) => {
        const viewport = carousel.querySelector("[data-embla-viewport]");
        if (!viewport) return;

        const embla = EmblaCarousel(
          viewport as HTMLElement,
          {
            loop: false,
            align: "start",
          },
          [Autoplay({ delay: 6000, stopOnInteraction: false })]
        );

        const prev = carousel.querySelector("[data-embla-prev]");
        const next = carousel.querySelector("[data-embla-next]");
        const dots = Array.from(carousel.querySelectorAll("[data-embla-dot]"));

        const setSelectedDot = () => {
          const selectedIndex = embla.selectedScrollSnap();
          dots.forEach((dot, index) => {
            dot.classList.toggle(
              "carousel-dot--active",
              index === selectedIndex
            );
          });
        };

        prev?.addEventListener("click", () => embla.scrollPrev());
        next?.addEventListener("click", () => embla.scrollNext());

        dots.forEach((dot, index) => {
          dot.addEventListener("click", () => embla.scrollTo(index));
        });

        embla.on("select", setSelectedDot);
        setSelectedDot();
      });
    });
  }
</script>
